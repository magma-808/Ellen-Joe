<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ellen Joe | Assistente Virtual IA - Zenless Zone Zero Universe (Expandable)</title>

  <meta name="description" content="Ellen Joe - Assistente Virtual com IA. VersÃ£o que pode gerar um HTML gigantesco (1MB+) para testes." />
  <meta name="keywords" content="Ellen Joe, Zenless Zone Zero, IA, Assistente Virtual, Chatbot" />
  <meta name="author" content="Ellen Joe AI" />
  <meta property="og:title" content="Ellen Joe - Assistente Virtual" />
  <meta property="og:description" content="Converse com a Ellen Joe" />

  <!-- Configure estes metadados conforme necessÃ¡rio -->
  <meta name="ai-proxy-endpoint" content="/api/ai" />
  <meta name="deepseek-endpoint" content="https://api.deepseek.example/v1/chat" />

  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¤–</text></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Exo+2:wght@300;400;600&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    :root{
      --neon-red:#ff003c; --neon-pink:#ff00ff; --bg-primary:#070707; --bg-card:rgba(18,18,18,0.95);
      --text-primary:#ffffff; --text-secondary:#dcdcdc; --text-tertiary:#9a9a9a;
      --border-radius-lg:18px; --glow-red:0 0 20px rgba(255,0,60,0.7);
      --font-heading:'Orbitron',sans-serif; --font-body:'Exo 2',sans-serif;
    }
    *{box-sizing:border-box} html,body{height:100%;margin:0;padding:0}
    body{font-family:var(--font-body);background:var(--bg-primary);color:var(--text-primary);-webkit-font-smoothing:antialiased;min-height:100vh;overflow:hidden;}

    .bg-layers{position:fixed;inset:0;z-index:-1;pointer-events:none;background:
      radial-gradient(circle at 10% 15%, rgba(255,0,60,0.06) 0%, transparent 18%),
      radial-gradient(circle at 90% 85%, rgba(157,0,255,0.05) 0%, transparent 18%),
      radial-gradient(circle at 50% 50%, rgba(0,255,255,0.02) 0%, transparent 40%);}

    .container{max-width:1200px;margin:0 auto;padding:16px;height:100vh;display:flex;flex-direction:column}
    header.header{display:flex;align-items:center;justify-content:space-between;padding:6px 0 14px 0;flex:0 0 auto}
    .logo{display:flex;align-items:center;gap:12px}
    .logo-icon{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--neon-red),var(--neon-pink));box-shadow:var(--glow-red)}
    .logo-title{font-family:var(--font-heading);font-size:18px;background:linear-gradient(45deg,var(--neon-red),var(--neon-pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

    .main{display:flex;flex:1;gap:18px;align-items:stretch;min-height:0}
    .chat-wrapper{flex:1;display:flex;flex-direction:column;border-radius:var(--border-radius-lg);background:var(--bg-card);border:1px solid rgba(255,0,60,0.06);box-shadow:0 12px 30px rgba(0,0,0,0.6);overflow:hidden;position:relative}
    .chat-header{padding:14px;display:flex;align-items:center;gap:14px;border-bottom:1px solid rgba(255,0,60,0.04);flex:0 0 auto}
    .assistant-avatar{width:58px;height:58px;border-radius:50%;background:linear-gradient(135deg,var(--neon-red),var(--neon-pink));display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
    .assistant-name{font-family:var(--font-heading);color:var(--neon-pink);font-size:1.05rem}
    .assistant-status{font-size:0.85rem;color:var(--text-tertiary)}

    .chat-body{display:flex;flex-direction:column;flex:1 1 auto;min-height:0}
    .chat-messages{flex:1 1 auto;padding:18px;overflow:auto;display:flex;flex-direction:column;gap:14px}
    .message{max-width:85%;padding:12px;border-radius:12px;word-wrap:break-word}
    .message.ai{align-self:flex-start;background:linear-gradient(135deg,rgba(40,40,60,0.9),rgba(60,20,50,0.9));border:1px solid rgba(255,0,60,0.08)}
    .message.user{align-self:flex-end;background:linear-gradient(135deg,rgba(255,0,60,0.12),rgba(255,0,255,0.06));border:1px solid rgba(255,0,60,0.16)}
    .meta{display:flex;justify-content:space-between;font-size:0.78rem;color:var(--text-tertiary);margin-bottom:8px}
    .content{font-size:0.98rem;color:var(--text-secondary);line-height:1.45}

    .chat-input-area{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;width:calc(100% - 32px);max-width:1100px;background:linear-gradient(180deg, rgba(12,12,12,0.92), rgba(0,0,0,0.78));padding:10px;border-radius:14px;border:1px solid rgba(255,255,255,0.025);backdrop-filter:blur(6px);z-index:30;box-shadow:0 12px 30px rgba(0,0,0,0.6);display:flex;gap:10px;align-items:center;}
    textarea#chatInput{resize:none;flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:rgba(0,0,0,0.45);color:var(--text-primary);min-height:46px;font-size:15px;line-height:1.3}
    .provider-select{padding:8px 10px;border-radius:10px;background:rgba(0,0,0,0.42);color:var(--text-primary);border:1px solid rgba(255,255,255,0.03);font-weight:600}
    .api-key-input{max-width:300px;padding:8px;border-radius:10px;background:rgba(0,0,0,0.35);color:var(--text-secondary);border:1px solid rgba(255,255,255,0.03);font-size:14px}
    .icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:10px;color:var(--text-tertiary);cursor:pointer}
    .btn{background:linear-gradient(135deg,var(--neon-red),var(--neon-pink));color:#fff;border:none;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700;box-shadow:var(--glow-red);transition:all 0.22s;display:inline-flex;align-items:center;justify-content:center;min-width:56px}
    .btn[disabled]{opacity:0.6;cursor:not-allowed}
    .small {font-size:12px;color:var(--text-tertiary)}
    .generator {display:flex;align-items:center;gap:8px}

    @media (max-width:900px){
      .main{flex-direction:column;min-height:calc(100vh - 160px)}
      .chat-input-area{left:12px;transform:none;width:calc(100% - 24px);max-width:none}
      .api-key-input{max-width:160px}
      .message{max-width:92%}
    }
  </style>
</head>
<body>
  <div class="bg-layers" aria-hidden="true"></div>

  <div class="container">
    <header class="header">
      <div class="logo">
        <div class="logo-icon" aria-hidden="true"><i class="fa-solid fa-robot"></i></div>
        <div>
          <div class="logo-title">Ellen Joe</div>
          <div style="font-size:0.78rem;color:var(--text-tertiary);letter-spacing:0.5px">Assistente Virtual â€¢ Zenless Zone Zero</div>
        </div>
      </div>

      <!-- Generator controls -->
      <div class="generator" title="Gerar HTML gigante">
        <label class="small" for="sizeMb">Tamanho (MB):</label>
        <input id="sizeMb" type="number" value="1" min="0.1" step="0.1" style="width:80px;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.4);color:var(--text-primary)"/>
        <button id="generateBtn" class="btn" title="Gerar e baixar um HTML com este tamanho (MB)">Gerar & Baixar</button>
      </div>
    </header>

    <main class="main" role="main">
      <section class="chat-wrapper" aria-label="Ãrea de chat">
        <div class="chat-header">
          <div class="assistant-avatar" aria-hidden="true"><i class="fa-solid fa-robot"></i></div>
          <div class="assistant-info">
            <div class="assistant-name">Ellen Joe</div>
            <div class="assistant-status">Online â€¢ Pronta para conversar</div>
          </div>
        </div>

        <div class="chat-body">
          <div id="chatMessages" class="chat-messages" role="log" aria-live="polite">
            <div class="message ai" id="welcomeMsg" data-seed="welcome">
              <div class="meta"><div>Ellen Joe</div><div>agora</div></div>
              <div class="content">OlÃ¡! Eu sou a Ellen Joe. Escreva algo e pressione Enter para enviar. Use o seletor para escolher fallback local ou OpenAI (se fornecer a chave).</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="chat-input-area" role="form" aria-label="Enviar mensagem">
    <div class="chat-input" style="width:100%">
      <textarea id="chatInput" placeholder="Escreva uma mensagem... (Enter envia, Shift+Enter nova linha)" rows="1" aria-label="Mensagem"></textarea>

      <select id="providerSelect" class="provider-select" title="Provedor IA" aria-label="Provedor IA">
        <option value="local">Fallback Local</option>
        <option value="openai">OpenAI (direct)</option>
        <option value="deepseek">DeepSeek (direct)</option>
      </select>

      <div style="display:flex;align-items:center;gap:6px">
        <input id="apiKeyInput" class="api-key-input" type="password" placeholder="API Key (opcional)" aria-label="Chave API"/>
        <button id="toggleApiKey" class="icon-btn" title="Mostrar/ocultar chave" aria-label="Mostrar/ocultar chave"><i class="fa-regular fa-eye"></i></button>
      </div>

      <button id="sendBtn" class="btn" aria-label="Enviar mensagem"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
  (function(){
    /* === Elements === */
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const providerSelect = document.getElementById('providerSelect');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const toggleApiKey = document.getElementById('toggleApiKey');
    const sizeMbInput = document.getElementById('sizeMb');
    const generateBtn = document.getElementById('generateBtn');

    const PROXY_ENDPOINT = document.querySelector('meta[name="ai-proxy-endpoint"]').content || '/api/ai';
    const DEEPSEEK_ENDPOINT = document.querySelector('meta[name="deepseek-endpoint"]').content || '';

    /* === small utilities === */
    function formatTime(date){ return date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }
    function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function createMessageElement({who, text, isTemporary=false}){
      const msg = document.createElement('div');
      msg.className = 'message ' + (who === 'user' ? 'user' : 'ai');
      if(isTemporary) msg.dataset.temp = '1';
      const meta = document.createElement('div'); meta.className = 'meta';
      meta.innerHTML = '<div>' + (who === 'user' ? 'VocÃª' : 'Ellen Joe') + '</div><div>' + formatTime(new Date()) + '</div>';
      const content = document.createElement('div'); content.className = 'content';
      content.innerHTML = escapeHtml(text).replace(/\n/g,'<br>');
      msg.appendChild(meta); msg.appendChild(content);
      return msg;
    }
    function appendMessage(obj){ const el = createMessageElement(obj); chatMessages.appendChild(el); requestAnimationFrame(()=>{ chatMessages.scrollTop = chatMessages.scrollHeight; }); return el; }
    function removeTempMessages(){ document.querySelectorAll('[data-temp="1"]').forEach(n=>n.remove()); }
    function setLoading(on){
      if(on){
        sendBtn.disabled = true; chatInput.disabled = true; providerSelect.disabled = true; apiKeyInput.disabled = true; toggleApiKey.disabled = true;
        removeTempMessages();
        const m = createMessageElement({who:'ai', text:'', isTemporary:true});
        m.querySelector('.content').innerHTML = '<span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#ff6a98;box-shadow:0 0 10px rgba(255,0,60,0.4);animation:1s infinite alternate;"></span> Pensando...';
        chatMessages.appendChild(m); chatMessages.scrollTop = chatMessages.scrollHeight;
      } else {
        sendBtn.disabled = false; chatInput.disabled = false; providerSelect.disabled = false; apiKeyInput.disabled = false; toggleApiKey.disabled = false;
        removeTempMessages();
      }
    }

    // Toggle key visibility
    toggleApiKey.addEventListener('click', () => {
      if(apiKeyInput.type === 'password'){ apiKeyInput.type = 'text'; toggleApiKey.innerHTML = '<i class="fa-regular fa-eye-slash"></i>'; }
      else { apiKeyInput.type = 'password'; toggleApiKey.innerHTML = '<i class="fa-regular fa-eye"></i>'; }
    });

    // Autosize textarea
    function autosize(){ chatInput.style.height = 'auto'; chatInput.style.height = Math.min(300, chatInput.scrollHeight) + 'px'; }
    chatInput.addEventListener('input', autosize); autosize();

    // Simple local fallback "bot"
    const LocalBot = (function(){
      let mem = [];
      function seed(t){ const w = (t||'').replace(/[^\wÃ¡Ã Ã¢Ã£Ã©ÃªÃ­Ã³Ã´ÃµÃºÃ§\s]/gi,' ').split(/\s+/).filter(Boolean); mem.push(...w); if(mem.length>4000) mem = mem.slice(-4000);}
      function random(a){ return a[Math.floor(Math.random()*a.length)]; }
      const canned = ['Interessante â€” me conte mais.','Humm... quero aprender sobre isso.','Posso ajudar com ideias ou sÃ³ conversar, como preferir.'];
      function rule(t){
        const s = (t||'').toLowerCase();
        if(/\b(oi|olÃ¡|ola)\b/.test(s)) return 'Oi! Como posso ajudar vocÃª hoje?';
        if(/\b(ajuda|help)\b/.test(s)) return 'Diga o que quer: conversar, pedir dicas do jogo, ou criar histÃ³rias.';
        if(/\b(zenless|zzz|zenless zone zero)\b/.test(s)) return 'Zenless Zone Zero Ã© um universo interessante â€” quer discutir personagens ou mecÃ¢nicas?';
        return null;
      }
      function gen(t){
        if(mem.length<6) return random(canned);
        // build small chain
        const last = (t||'').split(/\s+/).pop() || mem[Math.floor(Math.random()*mem.length)];
        const out = [last];
        for(let i=0;i<8;i++){
          const nexts = [];
          for(let j=0;j<mem.length-1;j++) if(mem[j]===out[out.length-1]) nexts.push(mem[j+1]);
          if(!nexts.length) break;
          out.push(random(nexts));
        }
        let text = out.join(' ');
        text = text.charAt(0).toUpperCase() + text.slice(1) + '.';
        if(text.length<20) text = random(canned);
        return text;
      }
      function respond(t){ seed(t); const r = rule(t); if(r) return r; return Math.random()<0.6 ? gen(t) : random(canned); }
      return {respond, seed};
    })();

    // Fetch with timeout
    async function fetchWithTimeout(url, opts={}, timeout=25000){
      const controller = new AbortController();
      const id = setTimeout(()=>controller.abort(), timeout);
      try { const res = await fetch(url, {...opts, signal:controller.signal}); clearTimeout(id); return res; }
      catch(e){ clearTimeout(id); throw e; }
    }

    // Send to OpenAI direct (if chosen)
    async function sendToOpenAI(text, apiKey){
      const body = {model:'gpt-3.5-turbo', messages:[{role:'system',content:'VocÃª Ã© Ellen Joe, assistente virtual amigÃ¡vel e Ãºtil no estilo Zenless Zone Zero.'},{role:'user',content:text}], max_tokens:600, temperature:0.9};
      const res = await fetchWithTimeout('https://api.openai.com/v1/chat/completions', {
        method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey}, body:JSON.stringify(body)
      }, 30000);
      if(!res.ok){ const t = await res.text().catch(()=>res.statusText); throw new Error('OpenAI falhou: '+res.status+' - '+t); }
      const j = await res.json();
      return (j.choices && j.choices[0] && j.choices[0].message && j.choices[0].message.content) ? j.choices[0].message.content.trim() : JSON.stringify(j);
    }

    // Send to DeepSeek (example direct)
    async function sendToDeepseek(text, apiKey){
      const res = await fetchWithTimeout(DEEPSEEK_ENDPOINT || PROXY_ENDPOINT, {method:'POST', headers:{'Content-Type':'application/json','Authorization': apiKey ? ('Bearer '+apiKey):''}, body: JSON.stringify({input:text})}, 30000);
      if(!res.ok){ const t = await res.text().catch(()=>res.statusText); throw new Error('DeepSeek falhou: '+res.status+' - '+t); }
      try { const j = await res.json(); return j.reply||j.output||j.message||JSON.stringify(j); } catch(e){ return await res.text(); }
    }

    // Proxy call (if user has server)
    async function sendToProxy(text, provider, apiKey){
      const payload = {input:text, provider}; if(apiKey) payload.api_key = apiKey;
      const res = await fetchWithTimeout(PROXY_ENDPOINT, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)}, 25000);
      if(!res.ok){ const t = await res.text().catch(()=>res.statusText); throw new Error('Proxy retornou: '+res.status+' - '+t); }
      try { const j = await res.json(); return j.reply||j.output||j.message||JSON.stringify(j); } catch(e){ return await res.text(); }
    }

    // Main: get assistant reply
    async function getAssistantReply(text){
      const provider = providerSelect.value || 'local';
      const key = apiKeyInput.value && apiKeyInput.value.trim() ? apiKeyInput.value.trim() : null;
      // Local fallback if provider is local or no key for remote providers
      if(provider === 'local' || (!key && (provider === 'openai' || provider === 'deepseek'))){
        return LocalBot.respond(text);
      }
      try {
        if(provider === 'openai'){ if(!key) throw new Error('Chave OpenAI necessÃ¡ria'); return await sendToOpenAI(text, key); }
        if(provider === 'deepseek'){ if(!key) throw new Error('Chave DeepSeek necessÃ¡ria'); return await sendToDeepseek(text, key); }
        // otherwise try proxy
        return await sendToProxy(text, provider, key);
      } catch(err){
        console.warn('Erro provider:', err);
        if(key) return 'NÃ£o foi possÃ­vel obter resposta do provedor remoto. Usando fallback local. (Erro: '+(err.message||err)+')\n\n'+LocalBot.respond(text);
        return 'NÃ£o foi possÃ­vel conectar ao provedor remoto (nenhuma chave). Usando fallback local.\n\n'+LocalBot.respond(text);
      }
    }

    // send message flow
    async function sendMessage(){
      const txt = chatInput.value;
      if(!txt || !txt.trim()) return;
      appendMessage({who:'user', text: txt});
      chatInput.value = ''; autosize();
      LocalBot.seed(txt);
      setLoading(true);
      try {
        const reply = await getAssistantReply(txt);
        appendMessage({who:'ai', text: String(reply) });
      } catch(e){
        appendMessage({who:'ai', text: 'Erro ao obter resposta: '+(e.message||e.toString())});
      } finally {
        setLoading(false);
        try { if(apiKeyInput.value && apiKeyInput.value.trim()) localStorage.setItem('ellenjoe_api_key_v1', apiKeyInput.value.trim()); else localStorage.removeItem('ellenjoe_api_key_v1'); } catch(e){}
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keydown', function(e){ if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); } });

    // Load saved key
    try { const s = localStorage.getItem('ellenjoe_api_key_v1'); if(s) apiKeyInput.value = s; } catch(e){}

    // Focus and scroll
    chatInput.focus();

    /* === Generator: cria e baixa um HTML funcional grande (inserindo comentÃ¡rio grande) === */
    function downloadBlob(filename, blob){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 15000);
    }

    generateBtn.addEventListener('click', async function(){
      const mb = Math.max(0.1, parseFloat(sizeMbInput.value) || 1);
      const target = Math.round(mb * 1024 * 1024); // bytes
      generateBtn.disabled = true
